name: Update LeetCode Stats
on:
  schedule: [{cron: "0 0 * * *"}] # 每天跑一次
  workflow_dispatch:               # 手動觸發

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        # 同時安裝畫圖需要的套件
        run: |
          pip install requests pandas matplotlib calplot

      - name: Draw Calendar Heatmap
        # 假設你剛剛那個熱力圖腳本叫 draw_calendar.py
        run: python scripts/draw_calendar.py

      - name: Draw Rating Graph
        # 執行這次新增的積分圖腳本
        run: python scripts/draw_rating.py

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          # 把產生的圖都加入
          git add assets/*.png
          # 如果圖沒變，就不 Commit (避免報錯)
          git commit -m "Update LeetCode Stats via Alfa API" || exit 0
          git push
